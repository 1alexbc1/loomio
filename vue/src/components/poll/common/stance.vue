<script lang="coffee">
import Session from '@/shared/services/session'
import PollModal from '@/mixins/poll_modal'
import { orderBy } from 'lodash'

export default
  mixins: [PollModal]
  components:
    PollCommonDirective: -> import('@/components/poll/common/directive')

  props:
    stance: Object
    reasonOnly:
      type: Boolean
      default: false

  computed:
    canEdit: ->
      @stance.latest && @stance.participant() == Session.user()

    orderedStanceChoices: ->
      order = if @stance.poll().pollType == 'ranked_choice'
        'asc'
      else
        'desc'
      orderBy @stance.stanceChoices(), 'rankOrScore', order
</script>

<template lang="pug">
.poll-common-stance
  span.caption(v-if='stance.stanceChoices().length == 0' v-t="'poll_common_votes_panel.none_of_the_above'" )
  v-layout(v-if="!reasonOnly" wrap align-center)
    poll-common-stance-choice(:stance-choice='choice', v-if='choice.score > 0', v-for='choice in orderedStanceChoices', :key='choice.id')
    v-btn(icon v-if="canEdit" color='accent', @click='openEditVoteModal(stance)')
      v-icon mdi-pencil
  formatted-text.poll-common-stance-created__reason(:model="stance" column="reason")
</template>
